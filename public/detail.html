<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>D√©tail du produit - Kolwaz Shop</title>
  <!-- Lien vers Font Awesome pour les ic√¥nes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
        integrity="sha512-Fo3rlrZj/k7ujTTXRFbPy1Y9T3rxg+e0B7IQbj0gfpQxRwN7rjkCrzEd3c3edczpPJp5eZ7Bs+F6W/6Knf8p1A==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
/* R√©initialisation */
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
}

/* Style global */
body {
  font-family: 'Poppins', sans-serif;
  background-color: #f9f9f9;
  color: #333;
  line-height: 1.6;
  padding: 20px;
  animation: fadeIn 1s ease forwards;
}

@keyframes fadeIn { 
  from { opacity: 0; } 
  to { opacity: 1; } 
}

/* HEADER : Barre de navigation */
header {
  margin-bottom: 30px;
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background-color: #131921;
  border-bottom: 2px solid #333;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  border-radius: 8px;
}

.navbar a {
  color: #fff;
  font-size: 24px;
  text-decoration: none;
  margin: 0 10px;
  transition: transform 0.3s, color 0.3s;
}

.navbar a:hover {
  transform: scale(1.1);
  color: #f44336;
}

.cart-icon {
  position: relative;
}

.cart-icon span {
  position: absolute;
  top: -5px;
  right: -10px;
  background: red;
  color: #fff;
  font-size: 14px;
  font-weight: bold;
  padding: 3px 7px;
  border-radius: 50%;
}

/* MAIN : Contenu principal */
main {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 40px;
}

/* Section : D√©tail du produit (mise en page en deux colonnes) */
#detailSection {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  background: #fff;
  border-radius: 10px;
  padding: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  animation: slideIn 0.8s ease forwards;
}

/* Partie gauche : Image principale + Galerie + Vid√©o */
#detailMedia {
  flex: 1;
  min-width: 40%;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

#detailMedia img {
  width: 100%;
  max-width: 400px;
  border-radius: 8px;
  margin-bottom: 15px;
  transition: transform 0.3s ease;
  cursor: pointer;
}

#detailMedia img:hover {
  transform: scale(1.03);
}

#detailVideo {
  width: 100%;
  max-width: 400px;
  border-radius: 8px;
  margin-top: 15px;
}

/* Galerie d'images */
#imageCarousel {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding-bottom: 10px;
  margin-bottom: 20px;
  justify-content: center;
}

#imageCarousel img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

#imageCarousel img:hover {
  transform: scale(1.1);
}

/* Partie droite : D√©tails du produit */
#detailInfo {
  flex: 1;
  min-width: 50%;
}

#detailInfo h2 {
  margin-bottom: 15px;
  font-size: 28px;
  color: #007bff;
}

#detailInfo p {
  font-size: 16px;
  margin-bottom: 10px;
  color: #555;
}

/* Boutons */
.btn {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.3s ease;
  font-size: 16px;
  margin-right: 10px;
}

.btn-primary {
  background: #28a745;
  color: #fff;
}

.btn-primary:hover {
  background: #218838;
  transform: scale(1.05);
}

.btn-secondary {
  background: #007bff;
  color: #fff;
}

.btn-secondary:hover {
  background: #0069d9;
  transform: scale(1.05);
}

/* Section : Produits similaires */
#similarGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

.similar-item {
  background: #fff;
  border-radius: 8px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.similar-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.similar-item img {
  width: 100%;
  height: auto;
  border-radius: 6px;
  margin-bottom: 10px;
}

.similar-item .product-name {
  font-weight: bold;
  margin-bottom: 5px;
  font-size: 18px;
}

.similar-item .product-price {
  color: #28a745;
  margin-bottom: 10px;
  font-size: 16px;
}

.similar-item .add-to-cart {
  padding: 8px 12px;
  background: #007bff;
  border: none;
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s ease;
  font-size: 16px;
}

.similar-item .add-to-cart:hover {
  background: #0069d9;
}

/* Notification */
#notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #28a745;
  color: #fff;
  padding: 15px 25px;
  border-radius: 8px;
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 1000;
}

#notification.show { 
  opacity: 1; 
}

/* Responsivit√© : empiler les √©l√©ments en colonne sur mobile */
@media (max-width: 768px) {
  #detailSection {
    flex-direction: column;
  }
  
  #detailMedia, #detailInfo {
    width: 100%;
  }
}
  </style>
</head>
<body>
  <!-- HEADER : Barre de navigation -->
  <header>
    <nav class="navbar">
      <a href="index.html" title="Accueil"><i class="fa fa-home"></i></a>
      <a href="index.html" title="Produits"><i class="fa fa-th-large"></i></a>
      <a href="contact.html" title="Contact"><i class="fa fa-envelope"></i></a>
      <div class="cart-icon">
        <a href="panier.html" title="Panier"><i class="fa fa-shopping-cart"></i></a>
        <span id="cartCount">0</span>
      </div>
    </nav>
  </header>
  
  <!-- MAIN : D√©tail du produit et Produits similaires -->
  <main>
   <!-- Section : D√©tail du produit -->
<section id="detailSection">
  <button id="goBackButton" class="btn btn-secondary" onclick="goBack()">Retour</button>
  
  <!-- Image principale -->
  <img id="detailImage" src="https://via.placeholder.com/500x400" alt="Image du produit">
  
  <h2 id="detailName">Nom du produit</h2>
  <p id="detailDescription">Description d√©taill√©e du produit...</p>
  <p><strong>Prix :</strong> <span id="detailPrice">0 FCFA</span></p>
  <p><strong>Vendu par :</strong> <span id="detailSeller">vendeur@example.com</span></p>

  <!-- Vid√©o du produit (si disponible) -->
  <video id="detailVideo" controls style="display: none;"></video>

  <!-- Galerie d'images compl√©mentaires -->
  <div id="imageCarousel">
    <!-- Les images seront ajout√©es dynamiquement -->
  </div>

  <!-- D√©tails suppl√©mentaires -->
  <div id="productDetails">
    <p><strong>Stock :</strong> <span id="detailStock">Non pr√©cis√©</span></p>
    <p><strong>Date de publication :</strong> <span id="detailCreatedAt">Non pr√©cis√©e</span></p>
    <p><strong>Commandes :</strong> <span id="detailOrders">0</span></p>
    <p><strong>Vues :</strong> <span id="detailViews">0</span></p>
    <p><strong>Remise :</strong> <span id="detailDiscount">Aucune</span></p>
    <p><strong>Type de remise :</strong> <span id="detailDiscountType">Non sp√©cifi√©</span></p>
    <p><strong>Marque :</strong> <span id="detailBrand">Non pr√©cis√©e</span></p>
    <p><strong>R√©f√©rence (SKU) :</strong> <span id="detailSKU">Non pr√©cis√©e</span></p>
    <p><strong>Poids :</strong> <span id="detailWeight">Non pr√©cis√©</span></p>
    <p><strong>Dimensions :</strong> <span id="detailDimensions">Non pr√©cis√©es</span></p>
    <p><strong>Co√ªt d'exp√©dition :</strong> <span id="detailShippingCost">Non pr√©cis√©</span></p>
    <p><strong>D√©lai de livraison :</strong> <span id="detailEstimatedDelivery">Non pr√©cis√©</span></p>
    <p><strong>Politique de retour :</strong> <span id="detailReturnPolicy">Non pr√©cis√©e</span></p>
    <p><strong>Garantie :</strong> <span id="detailWarranty">Non pr√©cis√©e</span></p>
  </div>

  <!-- Boutons d'action -->
  <button id="addToCartButton" class="btn btn-primary">Ajouter au panier</button>
  <button id="contactSellerButton" class="btn btn-secondary" style="display: none;">Contacter le vendeur</button>
</section>
    
    <!-- Section : Produits similaires -->
    <section id="similarGrid">
      <!-- Les produits similaires seront inject√©s ici -->
    </section>
  </main>
  
  <!-- Notification -->
  <div id="notification" class="notification"></div>
  
  <script>
// Variables globales
let cartCount = 0;
let currentProduct = {};
let allProducts = [];

// R√©cup√®re l'ID du produit depuis l'URL et charge ses donn√©es via l'API
document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const productId = params.get('id');

    if (!productId) {
        console.error("‚ö†Ô∏è Aucun ID produit trouv√© dans l'URL.");
        alert("Produit non identifi√©.");
        return;
    }

    console.log("‚úÖ ID du produit r√©cup√©r√© :", productId);
    fetchProduct(productId);
});

// Appel √† l'API pour r√©cup√©rer les donn√©es d'un produit
async function fetchProduct(productId) {
    try {
        console.log(`üîç R√©cup√©ration des donn√©es pour le produit ID : ${productId}...`);

        const response = await fetch(`/api/products/${productId}`);
        
        if (!response.ok) {
            throw new Error(`‚ùå Erreur API, statut : ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        console.log("‚úÖ Produit r√©cup√©r√© depuis l'API :", data);

        if (!data || !data.product) {
            console.error("‚ùå Produit introuvable ou r√©ponse mal formatt√©e :", data);
            alert("Erreur : Produit introuvable.");
            return;
        }

        currentProduct = data.product;
        showProductDetailView(data.product);
    } catch (error) {
        console.error("‚ùå Erreur lors de la r√©cup√©ration du produit :", error);
        alert("Erreur lors du chargement du produit. V√©rifiez votre connexion ou r√©essayez plus tard.");
    }
}
    
// Affiche les d√©tails du produit et pr√©pare la galerie et les produits similaires
function showProductDetailView(product) {
  // Mise √† jour des informations principales
  document.getElementById("detailImage").src = product.imageUrl || "https://via.placeholder.com/500x400";
  document.getElementById("detailName").innerText = product.productName || "Nom inconnu";
  document.getElementById("detailDescription").innerText = product.description || "";
  document.getElementById("detailPrice").innerText = product.price ? `${product.price} FCFA` : "";
  document.getElementById("detailSeller").innerText = product.sellerEmail || "Vendeur inconnu";

  // Mise √† jour des autres d√©tails (v√©rifiez que ces √©l√©ments existent dans votre HTML)
  if (document.getElementById("detailStock"))
    document.getElementById("detailStock").innerText = product.stock !== undefined ? product.stock : "Non pr√©cis√©";
  if (document.getElementById("detailCreatedAt"))
    document.getElementById("detailCreatedAt").innerText = product.createdAt ? new Date(product.createdAt).toLocaleDateString() : "Non pr√©cis√©";
  if (document.getElementById("detailOrders"))
    document.getElementById("detailOrders").innerText = product.orders !== undefined ? product.orders : "0";
  if (document.getElementById("detailViews"))
    document.getElementById("detailViews").innerText = product.views !== undefined ? product.views : "0";
  if (document.getElementById("detailDiscount"))
    document.getElementById("detailDiscount").innerText = product.discount !== undefined ? product.discount : "Aucune";
  if (document.getElementById("detailDiscountType"))
    document.getElementById("detailDiscountType").innerText = product.discountType || "";
  if (document.getElementById("detailBrand"))
    document.getElementById("detailBrand").innerText = product.brand || "Non pr√©cis√©e";
  if (document.getElementById("detailSKU"))
    document.getElementById("detailSKU").innerText = product.sku || "Non pr√©cis√©";
  if (document.getElementById("detailWeight"))
    document.getElementById("detailWeight").innerText = product.weight !== undefined ? product.weight + " kg" : "Non pr√©cis√©";
  if (document.getElementById("detailDimensions"))
    document.getElementById("detailDimensions").innerText = product.dimensions ? `${product.dimensions.length} x ${product.dimensions.width} x ${product.dimensions.height} cm` : "Non pr√©cis√©es";
  if (document.getElementById("detailShippingCost"))
    document.getElementById("detailShippingCost").innerText = product.shippingCost !== undefined ? product.shippingCost + " FCFA" : "Non pr√©cis√©";
  if (document.getElementById("detailEstimatedDelivery"))
    document.getElementById("detailEstimatedDelivery").innerText = product.estimatedDelivery !== undefined ? product.estimatedDelivery + " jours" : "Non pr√©cis√©";
  if (document.getElementById("detailReturnPolicy"))
    document.getElementById("detailReturnPolicy").innerText = product.returnPolicy || "Non pr√©cis√©e";
  if (document.getElementById("detailWarranty"))
    document.getElementById("detailWarranty").innerText = product.warranty || "Non pr√©cis√©e";

  // Gestion de la vid√©o
  const videoElement = document.getElementById("detailVideo");
  if (product.videoUrl) {
    videoElement.src = product.videoUrl;
    videoElement.style.display = "block";
  } else {
    videoElement.style.display = "none";
  }

  // G√©n√©ration de la galerie d'images compl√©mentaires
  const imageCarousel = document.getElementById("imageCarousel");
  imageCarousel.innerHTML = "";
  if (product.images && product.images.length > 0) {
    product.images.forEach(url => {
      const img = document.createElement("img");
      img.src = url;
      img.alt = product.productName;
      img.addEventListener("click", () => {
        document.getElementById("detailImage").src = url;
      });
      imageCarousel.appendChild(img);
    });
  }
      // Simulation ou appel √† l'API pour charger des produits similaires
      // Ici nous excluons le produit actuel
      allProducts = [
        product,
        {
          _id: "2",
          productName: "Produit Similaire 1",
          description: "Description du produit similaire 1.",
          price: 12000,
          sellerEmail: "vendeur1@example.com",
          imageUrl: "https://via.placeholder.com/500x400/008000",
          images: []
        },
        {
          _id: "3",
          productName: "Produit Similaire 2",
          description: "Description du produit similaire 2.",
          price: 18000,
          sellerEmail: "vendeur2@example.com",
          imageUrl: "https://via.placeholder.com/500x400/FFA500",
          images: []
        }
      ];
      const similarProducts = allProducts.filter(p => p._id !== product._id);
      displaySimilarProducts(similarProducts);
    }
    
    // Affiche la grille des produits similaires
    function displaySimilarProducts(products) {
      const similarGrid = document.getElementById("similarGrid");
      similarGrid.innerHTML = "";
      if (!products.length) {
        similarGrid.innerHTML = "<p>Aucun produit similaire trouv√©.</p>";
        return;
      }
      products.forEach(prod => {
        const div = document.createElement("div");
        div.className = "similar-item";
        div.innerHTML = `
          <img src="${prod.imageUrl}" alt="${prod.productName}">
          <div class="product-name">${prod.productName}</div>
          <div class="product-price">${prod.price} FCFA</div>
          <button class="add-to-cart" onclick="addToCart('${prod.productName}', ${prod.price}, '${prod.description}', '${prod.imageUrl}', '${prod.sellerEmail}', this)">Ajouter au panier</button>
        `;
        // Clic sur l'√©l√©ment pour afficher les d√©tails du produit (sauf sur le bouton)
        div.addEventListener("click", (e) => {
          if(e.target.tagName.toLowerCase() !== "button") {
            showProductDetailView(prod);
          }
        });
        similarGrid.appendChild(div);
      });
    }
    
    // Fonction Retour √† la page
    function goBack() { window.history.back(); }
    
    // Fonction pour ajouter un produit au panier
    function addToCart(name, price, description, imageUrl, sellerEmail, button) {
      button.textContent = "Ajout√© !";
      button.disabled = true;
      button.style.backgroundColor = "#28a745";
      // Simulation d'un appel API
      setTimeout(() => {
        cartCount++;
        updateCartCount();
        showNotification(`${name} a √©t√© ajout√© au panier !`);
      }, 500);
    }
    
    // Mise √† jour du compteur du panier
    function updateCartCount() {
      document.getElementById("cartCount").textContent = cartCount;
    }
    
    // Affiche une notification temporaire
    function showNotification(message) {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.classList.add("show");
      setTimeout(() => notification.classList.remove("show"), 3000);
    }
  </script>
</body>
</html>