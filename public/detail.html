<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Détail du produit - Kolwaz Shop</title>
  <!-- Lien vers Font Awesome pour les icônes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
        integrity="sha512-Fo3rlrZj/k7ujTTXRFbPy1Y9T3rxg+e0B7IQbj0gfpQxRwN7rjkCrzEd3c3edczpPJp5eZ7Bs+F6W/6Knf8p1A==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Réinitialisation */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    /* Style global */
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      line-height: 1.6;
      padding: 20px;
      animation: fadeIn 1s ease forwards;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    /* HEADER : Barre de navigation */
    header {
      margin-bottom: 30px;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: #131921;
      border-bottom: 2px solid #333;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    .navbar a {
      color: #fff;
      font-size: 24px;
      text-decoration: none;
      margin: 0 10px;
      transition: transform 0.3s, color 0.3s;
    }
    .navbar a:hover {
      transform: scale(1.1);
      color: #f44336;
    }
    .cart-icon {
      position: relative;
    }
    .cart-icon span {
      position: absolute;
      top: -5px;
      right: -10px;
      background: red;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      padding: 3px 7px;
      border-radius: 50%;
    }
    
    /* MAIN : Contenu principal */
    main {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 40px;
    }
    
/* Section : Détail du produit */
#detailSection {
  background: #fff;
  border-radius: 10px;
  padding: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  animation: slideIn 0.8s ease forwards;
}
@keyframes slideIn {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
#detailSection img {
  width: 100%;
  max-width: 500px;
  height: auto;
  border-radius: 8px;
  margin-bottom: 20px;
  transition: transform 0.3s ease;
  cursor: pointer;
}
#detailSection img:hover {
  transform: scale(1.03);
}
#detailSection h2 {
  margin-bottom: 15px;
  font-size: 32px;
  color: #007bff;
}
#detailSection p {
  margin-bottom: 12px;
  font-size: 18px;
}

/* Styles pour les autres détails du produit */
#detailStock,
#detailCreatedAt,
#detailOrders,
#detailViews,
#detailDiscount,
#detailDiscountType,
#detailBrand,
#detailSKU,
#detailWeight,
#detailDimensions,
#detailShippingCost,
#detailEstimatedDelivery,
#detailReturnPolicy,
#detailWarranty {
  font-size: 16px;
  margin-bottom: 10px;
  color: #555;
}

/* Vidéo du produit */
#detailVideo {
  width: 100%;
  max-width: 500px;
  border-radius: 8px;
  margin-bottom: 20px;
}

/* Galerie d'images complémentaires */
#imageCarousel {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding-bottom: 10px;
  margin-bottom: 20px;
}
#imageCarousel img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.3s ease;
}
#imageCarousel img:hover {
  transform: scale(1.1);
}
    
    /* Boutons d'action */
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      font-size: 18px;
      margin-right: 10px;
    }
    .btn-primary {
      background: #28a745;
      color: #fff;
    }
    .btn-primary:hover {
      background: #218838;
      transform: scale(1.05);
    }
    .btn-secondary {
      background: #007bff;
      color: #fff;
    }
    .btn-secondary:hover {
      background: #0069d9;
      transform: scale(1.05);
    }
    
    /* Section : Produits similaires */
    #similarGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }
    .similar-item {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }
    .similar-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .similar-item img {
      width: 100%;
      height: auto;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .similar-item .product-name {
      font-weight: bold;
      margin-bottom: 5px;
      font-size: 18px;
    }
    .similar-item .product-price {
      color: #28a745;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .similar-item .add-to-cart {
      padding: 8px 12px;
      background: #007bff;
      border: none;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 16px;
    }
    .similar-item .add-to-cart:hover {
      background: #0069d9;
    }
    
    /* Notification */
    #notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 1000;
    }
    #notification.show { opacity: 1; }
    
    /* Responsivité */
    @media (max-width: 768px) {
      #detailSection, #detailVideo, #detailSection img {
        max-width: 100%;
      }
      .btn { font-size: 16px; padding: 10px 16px; }
      #detailSection h2 { font-size: 28px; }
      #detailSection p { font-size: 16px; }
    }
  </style>
</head>
<body>
  <!-- HEADER : Barre de navigation -->
  <header>
    <nav class="navbar">
      <a href="index.html" title="Accueil"><i class="fa fa-home"></i></a>
      <a href="index.html" title="Produits"><i class="fa fa-th-large"></i></a>
      <a href="contact.html" title="Contact"><i class="fa fa-envelope"></i></a>
      <div class="cart-icon">
        <a href="panier.html" title="Panier"><i class="fa fa-shopping-cart"></i></a>
        <span id="cartCount">0</span>
      </div>
    </nav>
  </header>
  
  <!-- MAIN : Détail du produit et Produits similaires -->
  <main>
    <!-- Section : Détail du produit -->
    <section id="detailSection">
      <button id="goBackButton" class="btn btn-secondary" onclick="goBack()">Retour</button>
      <img id="detailImage" src="https://via.placeholder.com/500x400" alt="Image du produit">
      <h2 id="detailName">Nom du produit</h2>
      <p id="detailDescription">Description détaillée du produit...</p>
      <p id="detailPrice">Prix : 0 FCFA</p>
      <p id="detailSeller">Vendu par : vendeur@example.com</p>
      
      <!-- Vidéo du produit (affichée si disponible) -->
      <video id="detailVideo" controls style="display: none;"></video>
      
      <!-- Galerie d'images complémentaires -->
      <div id="imageCarousel">
        <!-- Les images seront générées dynamiquement -->
      </div>
      
      <!-- Boutons d'action -->
      <button id="addToCartButton" class="btn btn-primary" onclick="addToCart(currentProduct.productName, currentProduct.price, currentProduct.description, currentProduct.imageUrl, currentProduct.sellerEmail, this)">Ajouter au panier</button>
      <button id="contactSellerButton" class="btn btn-secondary" style="display: none;">Contacter le vendeur</button>
    </section>
    
    <!-- Section : Produits similaires -->
    <section id="similarGrid">
      <!-- Les produits similaires seront injectés ici -->
    </section>
  </main>
  
  <!-- Notification -->
  <div id="notification" class="notification"></div>
  
  <script>
    // Variables globales
    let cartCount = 0;
    let currentProduct = {};
    let allProducts = [];
    
    // Récupère l'ID du produit depuis l'URL et charge ses données via l'API
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const productId = params.get('id');
      if (productId) {
        fetchProduct(productId);
      } else {
        alert("Produit non identifié.");
      }
    });
    
    // Appel à l'API pour récupérer les données d'un produit
    function fetchProduct(productId) {
      fetch(`/api/products/${productId}`)
        .then(response => {
          if (!response.ok) throw new Error("Erreur réseau");
          return response.json();
        })
        .then(product => {
          currentProduct = product;
          showProductDetailView(product);
        })
        .catch(error => {
          console.error("Erreur lors de la récupération du produit :", error);
          alert("Erreur lors du chargement du produit.");
        });
    }
    
// Affiche les détails du produit et prépare la galerie et les produits similaires
function showProductDetailView(product) {
  // Mise à jour des informations principales
  document.getElementById("detailImage").src = product.imageUrl || "https://via.placeholder.com/500x400";
  document.getElementById("detailName").innerText = product.productName || "Nom inconnu";
  document.getElementById("detailDescription").innerText = product.description || "";
  document.getElementById("detailPrice").innerText = product.price ? `${product.price} FCFA` : "";
  document.getElementById("detailSeller").innerText = product.sellerEmail || "Vendeur inconnu";

  // Mise à jour des autres détails (vérifiez que ces éléments existent dans votre HTML)
  if (document.getElementById("detailStock"))
    document.getElementById("detailStock").innerText = product.stock !== undefined ? product.stock : "Non précisé";
  if (document.getElementById("detailCreatedAt"))
    document.getElementById("detailCreatedAt").innerText = product.createdAt ? new Date(product.createdAt).toLocaleDateString() : "Non précisé";
  if (document.getElementById("detailOrders"))
    document.getElementById("detailOrders").innerText = product.orders !== undefined ? product.orders : "0";
  if (document.getElementById("detailViews"))
    document.getElementById("detailViews").innerText = product.views !== undefined ? product.views : "0";
  if (document.getElementById("detailDiscount"))
    document.getElementById("detailDiscount").innerText = product.discount !== undefined ? product.discount : "Aucune";
  if (document.getElementById("detailDiscountType"))
    document.getElementById("detailDiscountType").innerText = product.discountType || "";
  if (document.getElementById("detailBrand"))
    document.getElementById("detailBrand").innerText = product.brand || "Non précisée";
  if (document.getElementById("detailSKU"))
    document.getElementById("detailSKU").innerText = product.sku || "Non précisé";
  if (document.getElementById("detailWeight"))
    document.getElementById("detailWeight").innerText = product.weight !== undefined ? product.weight + " kg" : "Non précisé";
  if (document.getElementById("detailDimensions"))
    document.getElementById("detailDimensions").innerText = product.dimensions ? `${product.dimensions.length} x ${product.dimensions.width} x ${product.dimensions.height} cm` : "Non précisées";
  if (document.getElementById("detailShippingCost"))
    document.getElementById("detailShippingCost").innerText = product.shippingCost !== undefined ? product.shippingCost + " FCFA" : "Non précisé";
  if (document.getElementById("detailEstimatedDelivery"))
    document.getElementById("detailEstimatedDelivery").innerText = product.estimatedDelivery !== undefined ? product.estimatedDelivery + " jours" : "Non précisé";
  if (document.getElementById("detailReturnPolicy"))
    document.getElementById("detailReturnPolicy").innerText = product.returnPolicy || "Non précisée";
  if (document.getElementById("detailWarranty"))
    document.getElementById("detailWarranty").innerText = product.warranty || "Non précisée";

  // Gestion de la vidéo
  const videoElement = document.getElementById("detailVideo");
  if (product.videoUrl) {
    videoElement.src = product.videoUrl;
    videoElement.style.display = "block";
  } else {
    videoElement.style.display = "none";
  }

  // Génération de la galerie d'images complémentaires
  const imageCarousel = document.getElementById("imageCarousel");
  imageCarousel.innerHTML = "";
  if (product.images && product.images.length > 0) {
    product.images.forEach(url => {
      const img = document.createElement("img");
      img.src = url;
      img.alt = product.productName;
      img.addEventListener("click", () => {
        document.getElementById("detailImage").src = url;
      });
      imageCarousel.appendChild(img);
    });
  }
      // Simulation ou appel à l'API pour charger des produits similaires
      // Ici nous excluons le produit actuel
      allProducts = [
        product,
        {
          _id: "2",
          productName: "Produit Similaire 1",
          description: "Description du produit similaire 1.",
          price: 12000,
          sellerEmail: "vendeur1@example.com",
          imageUrl: "https://via.placeholder.com/500x400/008000",
          images: []
        },
        {
          _id: "3",
          productName: "Produit Similaire 2",
          description: "Description du produit similaire 2.",
          price: 18000,
          sellerEmail: "vendeur2@example.com",
          imageUrl: "https://via.placeholder.com/500x400/FFA500",
          images: []
        }
      ];
      const similarProducts = allProducts.filter(p => p._id !== product._id);
      displaySimilarProducts(similarProducts);
    }
    
    // Affiche la grille des produits similaires
    function displaySimilarProducts(products) {
      const similarGrid = document.getElementById("similarGrid");
      similarGrid.innerHTML = "";
      if (!products.length) {
        similarGrid.innerHTML = "<p>Aucun produit similaire trouvé.</p>";
        return;
      }
      products.forEach(prod => {
        const div = document.createElement("div");
        div.className = "similar-item";
        div.innerHTML = `
          <img src="${prod.imageUrl}" alt="${prod.productName}">
          <div class="product-name">${prod.productName}</div>
          <div class="product-price">${prod.price} FCFA</div>
          <button class="add-to-cart" onclick="addToCart('${prod.productName}', ${prod.price}, '${prod.description}', '${prod.imageUrl}', '${prod.sellerEmail}', this)">Ajouter au panier</button>
        `;
        // Clic sur l'élément pour afficher les détails du produit (sauf sur le bouton)
        div.addEventListener("click", (e) => {
          if(e.target.tagName.toLowerCase() !== "button") {
            showProductDetailView(prod);
          }
        });
        similarGrid.appendChild(div);
      });
    }
    
    // Fonction Retour à la page
    function goBack() { window.history.back(); }
    
    // Fonction pour ajouter un produit au panier
    function addToCart(name, price, description, imageUrl, sellerEmail, button) {
      button.textContent = "Ajouté !";
      button.disabled = true;
      button.style.backgroundColor = "#28a745";
      // Simulation d'un appel API
      setTimeout(() => {
        cartCount++;
        updateCartCount();
        showNotification(`${name} a été ajouté au panier !`);
      }, 500);
    }
    
    // Mise à jour du compteur du panier
    function updateCartCount() {
      document.getElementById("cartCount").textContent = cartCount;
    }
    
    // Affiche une notification temporaire
    function showNotification(message) {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.classList.add("show");
      setTimeout(() => notification.classList.remove("show"), 3000);
    }
  </script>
</body>
</html>