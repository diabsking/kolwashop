<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kolwaz Shop - Votre Boutique en Ligne</title>
  <style>
    /* Global */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #F4F7FA;
      color: #333;
      line-height: 1.6;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    a { text-decoration: none; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* En-tête supérieur revisité */
    header {
      background: linear-gradient(135deg, #131921, #2b3e50);
      color: #fff;
      padding: 15px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .top-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .top-header .logo {
      font-size: 32px;
      font-weight: bold;
      color: #febd69;
    }
    /* Barre de recherche moderne */
    .search-bar-container {
      background: #fff;
      padding: 30px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      text-align: center;
      margin-bottom: 10px;
    }
    .search-container {
      display: flex;
      justify-content: center;
      max-width: 700px;
      width: 90%;
      margin: 0 auto;
      border-radius: 50px;
      overflow: hidden;
      background-color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .search-container input {
      flex-grow: 1;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      outline: none;
    }
    .search-container input:focus {
      box-shadow: inset 0 0 0 2px #febd69;
    }
    .search-container button {
      background-color: #febd69;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .search-container button:hover {
      background-color: #f8a94b;
    }

    /* Barre de navigation */
    .navbar {
      display: flex;
      justify-content: flex-end;
      padding: 10px 20px;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background-color 0.3s;
    }
    .navbar a {
      font-size: 20px;
      color: #333;
      margin: 0 10px;
      position: relative;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    .navbar a:hover {
      background-color: #f0f0f0;
    }
    .navbar a .icon {
      margin-right: 5px;
    }
    .navbar a span {
      font-weight: bold;
    }

    /* Panier */
    .cart-icon {
      position: relative;
    }
    .cart-icon span {
      position: absolute;
      top: -5px;
      right: -10px;
      background: red;
      color: white;
      font-size: 14px;
      font-weight: bold;
      padding: 3px 7px;
      border-radius: 50%;
    }
    #cartCount {
      position: absolute;
      top: -5px;
      right: -10px;
      background-color: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 10px;
    }
    
    /* Boutons de catégories */
    .category-buttons {
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      padding: 10px;
      background-color: #fff;
      border-bottom: 1px solid #ccc;
    }
    .category-button {
      flex: 0 0 auto;
      margin-right: 10px;
      padding: 10px 20px;
      background-color: #fff;
      color: #333;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      border: 1px solid #ddd;
      transition: transform 0.3s, background-color 0.3s;
    }
    .category-button:hover {
      background-color: #f0f0f0;
      transform: scale(1.05);
    }
    
    /* Section Produits */
    main section {
      background-color: #ffffff;
      padding: 40px 0;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 100%;
      padding: 20px;
      margin: 0 auto;
    }
    .grid-item {
      background-color: #fff;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 150px;
      position: relative;
      transition: box-shadow 0.3s;
    }
    .grid-item:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .grid-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .grid-item .product-name {
      font-size: 13px;
      font-weight: bold;
      margin-top: auto;
    }
    .grid-item .product-price {
      font-size: 12px;
      color: #ff9900;
      font-weight: bold;
    }
    
    /* Section Détail Produit - Design Professionnel */
    #detailSection {
      display: none;
      background-color: #fff;
      margin: 20px auto;
      padding: 30px;
      max-width: 800px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 10px;
    }
    #detailSection h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #007bff;
    }
    #detailImage {
      width: 100%;
      max-width: 400px;
      border-radius: 8px;
      display: block;
      margin: 0 auto 20px;
    }
    #imageCarousel {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      margin: 10px 0;
      padding-bottom: 10px;
    }
    #imageCarousel img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.3s;
    }
    #imageCarousel img:hover {
      transform: scale(1.1);
    }
    #detailVideo {
      width: 100%;
      max-width: 400px;
      border-radius: 8px;
      display: block;
      margin: 20px auto;
    }
    /* Détails produits */
    .detail-info {
      margin: 10px 0;
      font-size: 1rem;
    }
    .detail-info strong {
      color: #007bff;
    }
    /* Boutons d'action dans la vue détail */
    .detail-buttons {
      text-align: center;
      margin-top: 20px;
    }
    .detail-buttons button {
      padding: 10px 20px;
      margin: 10px 5px;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .detail-buttons button:hover {
      background-color: #f8a94b;
    }
    
    /* Produits similaires */
    .similar-products {
      margin-top: 30px;
      width: 100%;
    }
    .similar-products h2 {
      font-size: 20px;
      margin-bottom: 10px;
      text-align: center;
    }
    .similar-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 20px;
      padding: 20px;
      box-sizing: border-box;
    }
    .similar-item {
      background: #fff;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
      transition: transform 0.3s;
      cursor: pointer;
    }
    .similar-item:hover {
      transform: scale(1.05);
    }
    .similar-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
    }
    .similar-item .product-name {
      font-size: 14px;
      font-weight: bold;
      margin-top: 10px;
    }
    .similar-item .product-price {
      font-size: 14px;
      color: #ff9900;
      font-weight: bold;
      margin: 5px 0;
    }
   .grid-container {
  display: grid;
  grid-template-columns: repeat(5, 1fr); /* Par défaut, 5 produits par ligne */
  gap: 20px;
  width: 100%;
  max-width: 100%;
  padding: 20px;
  margin: 0 auto;
}

/* Ajustement pour les écrans moyens (tablettes) */
@media (max-width: 1024px) {
  .grid-container {
    grid-template-columns: repeat(4, 1fr); /* 4 produits par ligne */
  }
}

/* Ajustement pour les téléphones */
@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: repeat(3, 1fr); /* 3 produits par ligne */
    gap: 10px; /* Réduction de l’espace */
    padding: 10px; /* Réduction du padding global */
  }

  .grid-item {
    padding: 8px;
    border-radius: 10px; /* Coins plus arrondis */
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Ombre légère */
    transition: transform 0.2s ease-in-out;
  }

  .grid-item:hover {
    transform: scale(1.05); /* Effet zoom au survol */
  }

  .grid-item img {
    height: 120px; /* Réduction de la hauteur des images */
    border-radius: 5px; /* Arrondi des bords */
  }

  .grid-item .product-name {
    font-size: 14px; /* Augmentation légère pour lisibilité */
    font-weight: bold;
  }

  .grid-item .product-price {
    font-size: 12px;
    color: #ff5722; /* Changement de couleur pour plus de visibilité */
  }
}

/* Affichage en liste sur très petits écrans (moins de 480px) */
@media (max-width: 480px) {
  .grid-container {
    display: flex;
    flex-direction: column; /* Affichage en colonne */
    gap: 15px;
  }

  .grid-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: #fff;
    border-radius: 10px;
  }

  .grid-item img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 5px;
  }

  .grid-item .product-details {
    flex: 1; /* Permet d'occuper l'espace restant */
  }

  .grid-item .product-name {
    font-size: 16px;
    font-weight: bold;
  }

  .grid-item .product-price {
    font-size: 14px;
    color: #ff5722;
    font-weight: bold;
  }
}


/* Ajustement pour les très petits écrans (mobiles étroits) */
@media (max-width: 480px) {
  .grid-container {
    grid-template-columns: repeat(2, 1fr); /* 2 produits par ligne */
  }
}
    
    /* Footer */
    footer {
      background-color: #131921;
      color: #fff;
      padding: 40px 20px;
      font-size: 14px;
      margin-top: 40px;
    }
    .footer-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .footer-column {
      flex: 1;
      min-width: 250px;
      margin: 10px;
    }
    .footer-column h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .footer-column p {
      line-height: 1.5;
    }
    .footer-bottom {
      text-align: center;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      padding-top: 10px;
    }
    
    /* Toaster Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 14px;
      display: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .notification.show { display: block; opacity: 1; }
    
    /* Responsive ajustements */
    @media (max-width: 768px) {
      .navbar a { font-size: 16px; }
      .top-header .logo { font-size: 24px; }
      .search-container { width: 90%; }
    }
  </style>
</head>
<body>
  <!-- En-tête -->
  <header>
    <div class="top-header">
      <div class="logo">Kolwaz Shop</div>
      <!-- Vous pouvez ajouter ici un slogan si besoin -->
      <div class="slogan" style="font-size: 14px; font-style: italic;">Votre expérience d'achat premium</div>
    </div>
    <div class="search-bar-container">
      <div class="search-container">
        <input type="text" id="searchBox" placeholder="Rechercher un produit...">
        <button id="searchBtn">Rechercher</button>
      </div>
    </div>
    <!-- Barre de navigation -->
    <nav class="navbar">
      <a href="/" title="Accueil"><span class="icon">🏠</span><span>Accueil</span></a>
      <a href="/espace-vendeur" title="Espace Vendeur"><span class="icon">👤</span><span>Vendeur</span></a>
      <a href="/panier" title="Panier" class="cart-icon"><span class="icon">🛒</span><span>Panier</span> <span id="cartCount">0</span></a>
    </nav>
  </header>
  
  <!-- Boutons de catégories -->
  <div class="category-buttons">
    <button class="category-button" data-category="Tous">Tous</button>
    <button class="category-button" data-category="Homme">Homme</button>
    <button class="category-button" data-category="Femme">Femme</button>
    <button class="category-button" data-category="Garçon">Garçon</button>
    <button class="category-button" data-category="Fille">Fille</button>
    <button class="category-button" data-category="Bébé">Bébé</button>
    <button class="category-button" data-category="Enfant">Enfant</button>
    <button class="category-button" data-category="Sport">Sport</button>
    <button class="category-button" data-category="Livres">Livres</button>
    <button class="category-button" data-category="Matériels">Matériels</button>
    <button class="category-button" data-category="Cosmétique">Cosmétique</button>
    <button class="category-button" data-category="Accessoires">Accessoires</button>
    <button class="category-button" data-category="Electronique">Electronique</button>
  </div>
  
  <!-- Section Produits -->
  <main>
    <div class="popular-products">
      <h2>Produits Populaires</h2>
      <div class="popular-carousel" id="popularProducts"></div>
    </div>
    <section>
      <div id="loadingIndicator" class="loading-container">
        <div class="spinner"></div>
        <p>Chargement des produits...</p>
      </div>
      <div id="loading" class="loading">Chargement en cours...</div>
      <div id="product-list"></div>
      <div id="productGrid" class="grid-container"></div>
    </section>
    <div id="productContainer" style="display: none;"></div>
    
    <!-- Section de détail du produit -->
    <div id="detailSection">
      <h2>Détails du Produit</h2>
      <div style="text-align: center;">
        <img id="detailImage" src="" alt="Image du produit">
      </div>
      
      <h3>Galerie d'images</h3>
      <div id="imageCarousel"></div>
      
      <h3>Vidéo de Présentation</h3>
      <div style="text-align: center;">
        <video id="detailVideo" controls style="display: none;"></video>
      </div>
      
      <!-- Informations générales -->
      <div class="detail-info"><strong>Nom du produit : </strong><span id="detailName"></span></div>
      <div class="detail-info"><strong>Description : </strong><span id="detailDescription"></span></div>
      <div class="detail-info"><strong>Prix : </strong><span id="detailPrice"></span></div>
      <div class="detail-info"><strong>Vendeur : </strong><span id="detailSeller"></span></div>
      <div class="detail-info"><strong>Stock disponible : </strong><span id="detailStock"></span></div>
      <div class="detail-info"><strong>Date de publication : </strong><span id="detailCreatedAt"></span></div>
      <div class="detail-info"><strong>Nombre de commandes : </strong><span id="detailOrders"></span></div>
      <div class="detail-info"><strong>Nombre de vues : </strong><span id="detailViews"></span></div>
      <div class="detail-info"><strong>Options d'ajout au panier : </strong><span id="detailAddToCart"></span></div>
      
      <!-- Informations complémentaires -->
      <div class="detail-info"><strong>Remise : </strong><span id="detailDiscount"></span></div>
      <div class="detail-info"><strong>Marque : </strong><span id="detailBrand"></span></div>
      <div class="detail-info"><strong>Référence (SKU) : </strong><span id="detailSKU"></span></div>
      <div class="detail-info"><strong>Poids : </strong><span id="detailWeight"></span> kg</div>
      <div class="detail-info"><strong>Dimensions (L x l x H) : </strong><span id="detailDimensions"></span> cm</div>
      <div class="detail-info"><strong>Frais de livraison : </strong><span id="detailShippingCost"></span> FCFA</div>
      <div class="detail-info"><strong>Délai de livraison estimé : </strong><span id="detailEstimatedDelivery"></span> jours</div>
      <div class="detail-info"><strong>Politique de retour : </strong><span id="detailReturnPolicy"></span></div>
      <div class="detail-info"><strong>Garantie : </strong><span id="detailWarranty"></span></div>
      
      <!-- Avis -->
      <div id="reviewSection"></div>
      
      <!-- Boutons d'action -->
      <div class="detail-buttons">
        <button id="contactSellerButton" style="display: none;">Contacter le vendeur</button>
        <button id="addToCartButton">Ajouter au panier</button>
        <button id="prevProduct">Produit précédent</button>
        <button id="nextProduct">Produit suivant</button>
        <button id="returnToProductsButton">Retour aux produits</button>
      </div>
      
      <!-- Produits similaires -->
      <div class="similar-products">
        <h2>Produits Similaires</h2>
        <div id="similarGrid" class="similar-grid"></div>
      </div>
      
      <!-- Section pour discuter avec le vendeur -->
      <div id="contactSellerSection">
        <h3>Discuter avec le vendeur</h3>
        <textarea id="contactSellerMessage" placeholder="Votre message"></textarea>
        <button onclick="contactSeller()">Envoyer</button>
      </div>
    </div>
    
    <div id="review-section">
      <!-- Les avis clients s'afficheront ici -->
    </div>
  </main>
  
  <!-- Pied de page -->
  <footer>
    <div class="footer-container">
      <div class="footer-column about">
        <h3>À propos de Kolwaz Shop</h3>
        <p>Kolwaz Shop est votre boutique en ligne de confiance offrant des produits de qualité et un service exceptionnel. Découvrez notre vaste gamme et profitez d'une expérience d'achat inégalée.</p>
      </div>
      <div class="footer-column links">
        <h3>Liens rapides</h3>
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="/espace-vendeur">Espace vendeur</a></li>
          <li><a href="/panier">Panier</a></li>
          <li><a href="/Administrateur">Administrateur</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
      </div>
      <div class="footer-column contact">
        <h3>Comment devenir vendeur</h3>
        <p>Inscription et création de compte via notre site.</p>
      </div>
      <div class="footer-column social">
        <h3>Suivez-nous</h3>
        <ul class="social-icons" style="display: flex; list-style: none; gap: 10px;">
          <li>
            <a href="#" aria-label="Facebook">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
                <path d="M22.675 0h-21.35C.597 0 0 .597 0 1.325v21.351C0 23.403.597 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.894-4.787 4.658-4.787 1.325 0 2.462.099 2.794.143v3.24l-1.917.001c-1.504 0-1.796.714-1.796 1.764v2.312h3.592l-.467 3.622h-3.125V24h6.127c.728 0 1.325-.597 1.325-1.324V1.325C24 .597 23.403 0 22.675 0z"/>
              </svg>
            </a>
          </li>
          <li>
            <a href="#" aria-label="Twitter">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
                <path d="M23.954 4.569c-.885.394-1.83.657-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.95.555-2.005.959-3.127 1.184-.897-.957-2.173-1.555-3.591-1.555-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.125-4.09-.205-7.719-2.165-10.148-5.144-.424.722-.666 1.56-.666 2.476 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.229-.616v.061c0 2.385 1.693 4.374 3.946 4.828-.413.111-.849.171-1.296.171-.317 0-.626-.03-.927-.086.631 1.956 2.462 3.38 4.63 3.423-1.7 1.328-3.839 2.115-6.165 2.115-.4 0-.79-.023-1.17-.067 2.196 1.41 4.808 2.23 7.616 2.23 9.142 0 14.307-7.721 14.307-14.417 0-.22-.005-.437-.014-.653.982-.71 1.834-1.597 2.507-2.61z"/>
              </svg>
            </a>
          </li>
          <li>
            <a href="#" aria-label="Instagram">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
                <path d="M12 2.163c3.204 0 3.584.012 4.849.07 1.366.062 2.633.327 3.608 1.302.975.975 1.24 2.242 1.302 3.608.058 1.265.069 1.645.069 4.849s-.012 3.584-.07 4.849c-.062 1.366-.327 2.633-1.302 3.608-.975.975-2.242 1.24-3.608 1.302-1.265.058-1.645.069-4.849.069s-3.584-.012-4.849-.07c-1.366-.062-2.633-.327-3.608-1.302-.975-.975-1.24-2.242-1.302-3.608-.058-1.265-.069-1.645-.069-4.849s.012-3.584.07-4.849c.062-1.366.327-2.633 1.302-3.608.975-.975 2.242-1.24 3.608-1.302 1.265-.058 1.645-.069 4.849-.069M12 0C8.741 0 8.332.012 7.052.07 5.746.128 4.57.354 3.527 1.394 2.485 2.434 2.26 3.609 2.202 4.915 2.144 6.195 2.132 6.604 2.132 9.863s.012 3.668.07 5.948c.058 1.306.283 2.481 1.325 3.521 1.042 1.041 2.217 1.266 3.521 1.325 1.28.058 1.689.07 4.948.07s3.668-.012 4.948-.07c1.306-.058 2.481-.283 3.521-1.325 1.041-1.042 1.266-2.217 1.325-3.521.058-1.28.07-1.689.07-4.948s-.012-3.668-.07-4.948c-.058-1.306-.283-2.481-1.325-3.521C19.766.354 18.591.128 17.285.07 16.005.012 15.595 0 12 0zm0 5.838c-3.408 0-6.162 2.754-6.162 6.162s2.754 6.162 6.162 6.162 6.162-2.754 6.162-6.162-2.754-6.162-6.162-6.162zm0 10.162c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm6.406-10.845c-.796 0-1.44.645-1.44 1.44s.645 1.44 1.44 1.44 1.44-.645 1.44-1.44-.645-1.44-1.44-1.44z"/>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Kolwaz Shop. Tous droits réservés.</p>
      <p>&copy; Diasking.</p>
    </div>
  </footer>
  
  <!-- Toaster notification -->
  <div id="notification" class="notification"></div>
  
  <!-- Indicateur de chargement -->
  <div id="loadingIndicator" style="display: none;">Chargement...</div>
  <div id="productContainer"></div>
  
  <script>
    // Variables globales
    let allProducts = [];
    let cartCount = 0;
    let currentProduct = null;

    // Fonction pour afficher/cacher le formulaire de publication (si utilisé)
    function togglePublicationForm() {
      const formSection = document.getElementById("publicationForm");
      if(formSection) {
        formSection.style.display = (formSection.style.display === "block") ? "none" : "block";
      }
    }

    // Fonctions dummy
    function displayConfirmationMessage() {
      console.log("Confirmation message affichée.");
    }
    function fetchSellerProducts() {
      console.log("fetchSellerProducts appelé.");
    }
    function setupSidebarFilters() {
      const rows = document.querySelectorAll('#filterTable td');
      rows.forEach(row => {
        row.addEventListener('click', () => {
          const keyword = row.textContent.trim();
          filterProductsByKeyword(keyword);
        });
      });
    }
    function filterProductsByKeyword(keyword) {
      const searchText = keyword.toLowerCase();
      const filtered = allProducts.filter(product => {
        return (product.productName && product.productName.toLowerCase().includes(searchText)) ||
               (product.description && product.description.toLowerCase().includes(searchText)) ||
               (product.detectedCategory && product.detectedCategory.toLowerCase().includes(searchText));
      });
      displayProducts(filtered);
    }
    async function loadReviews(productId) {
      const reviewSection = document.getElementById("review-section");
      reviewSection.innerHTML = "<p>Aucun avis pour le moment.</p>";
    }
    function hideDetailSection() {
      document.getElementById("detailSection").style.display = "none";
      document.getElementById("productGrid").style.display = "grid";
    }
    function orderProduct(button) {
      if (!currentProduct) return;
      addToCart(currentProduct.productName, currentProduct.price, currentProduct.description, currentProduct.imageUrl, currentProduct.sellerEmail, button);
    }

    // Initialisation
    window.addEventListener('load', function() {
      loadProducts();
      setupCategoryFilters();
      setupSearch();
      setupSidebarFilters();
      displayConfirmationMessage();
      fetchSellerProducts();
      document.getElementById("addToCartButton").addEventListener("click", function() {
        if (currentProduct) {
          addToCart(currentProduct.productName, currentProduct.price, currentProduct.description, currentProduct.imageUrl, currentProduct.sellerEmail, this);
        }
      });
    });

    // Chargement des produits
    async function loadProducts() {
      const loadingIndicator = document.getElementById('loadingIndicator');
      const productGrid = document.getElementById('productGrid');
      loadingIndicator.style.display = 'block';
      productGrid.style.display = 'none';
      try {
        await new Promise(resolve => setTimeout(resolve, 1500));
        const response = await fetch('/api/products');
        if (!response.ok) throw new Error('Erreur serveur');
        const data = await response.json();
        allProducts = data.products || [];
        allProducts.forEach(product => {
          product.detectedCategory = product.detectedCategory || aiDetectCategory(product);
        });
        allProducts.sort((a, b) => (b.orders || 0) - (a.orders || 0));
        displayProducts(allProducts);
      } catch (err) {
        console.error("Erreur lors du chargement des produits:", err);
      } finally {
        loadingIndicator.style.display = 'none';
        productGrid.style.display = 'grid';
      }
    }

    // Affichage des produits
    function displayProducts(products) {
      const productGrid = document.getElementById("productGrid");
      productGrid.innerHTML = products.length
        ? ""
        : "<p style='text-align:center;'>Aucun produit publié pour le moment.</p>";
      products.forEach(product => {
        const productItem = document.createElement("div");
        productItem.className = 'grid-item';
        let badgeHTML = '';
        if (product.publishedAt) {
          const publishedDate = new Date(product.publishedAt);
          const now = new Date();
          const diffDays = (now - publishedDate) / (1000 * 60 * 60 * 24);
          if (diffDays < 7) {
            badgeHTML = '<span class="new-badge">Nouveau</span>';
          }
        }
        productItem.innerHTML =
          `<div class="product-image-wrapper" style="position: relative;">
             <img src="${product.imageUrl}" alt="${product.productName}">
             ${badgeHTML}
           </div>
           <div class="product-name">${product.productName}</div>
           <div class="product-description" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
             ${product.description}
           </div>
           <div class="product-price">${product.price} FCFA</div>`;
        productItem.addEventListener("click", () => {
          showProductDetailView(product);
        });
        productGrid.appendChild(productItem);
      });
    }

    // Recherche
    function setupSearch() {
      const searchBtn = document.getElementById("searchBtn");
      const searchBox = document.getElementById("searchBox");
      searchBtn.addEventListener("click", () => {
        const query = searchBox.value.trim().toLowerCase();
        const filtered = allProducts.filter(product => {
          return (product.productName && product.productName.toLowerCase().includes(query)) ||
                 (product.description && product.description.toLowerCase().includes(query)) ||
                 (product.detectedCategory && product.detectedCategory.toLowerCase().includes(query));
        });
        displayProducts(filtered);
      });
      searchBox.addEventListener("keyup", (event) => {
        if (event.key === "Enter") searchBtn.click();
      });
    }

    // Filtres par catégorie
    function setupCategoryFilters() {
      const buttons = document.querySelectorAll('.category-button');
      const productGrid = document.getElementById('productGrid');
      const loadingIndicator = document.getElementById('loading');
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const category = button.getAttribute('data-category');
          loadingIndicator.style.display = 'block';
          setTimeout(() => {
            let filteredProducts;
            if (category.toLowerCase() === 'tous') {
              filteredProducts = allProducts;
            } else {
              filteredProducts = allProducts.filter(product =>
                product.detectedCategory &&
                product.detectedCategory.toLowerCase().includes(category.toLowerCase())
              );
            }
            loadingIndicator.style.display = 'none';
            if (filteredProducts.length === 0) {
              productGrid.innerHTML = "<p style='text-align:center;'>Aucun produit trouvé pour cette catégorie.</p>";
            } else {
              displayProducts(filteredProducts);
            }
          }, 500);
        });
      });
    }

    // Détection de catégorie
    function aiDetectCategory(product, chosenCategory) {
      if (chosenCategory) return chosenCategory.toLowerCase();
      const name = product.productName ? product.productName.toLowerCase() : '';
      const description = product.description ? product.description.toLowerCase() : '';
      const imageUrl = product.imageUrl ? product.imageUrl.toLowerCase() : '';
      const categoriesKeywords = {
        "homme": ["homme", "men", "garçon", "costume", "habit", "veste", "pantalon", "chemise"],
        "femme": ["femme", "woman", "dame", "robe", "jupe", "blouse", "maquillage", "sac à main"],
        "garçon": ["garçon", "boy", "enfant garçon", "jeune homme", "ado garçon", "t-shirt garçon"],
        "fille": ["fille", "girl", "jeune fille", "ado fille", "robe fille", "jupe fille"],
        "bébé": ["bébé", "enfant", "nourrisson", "bambin"],
        "cosmétique": ["cosmétique", "makeup", "maquillage", "parfum", "soin"],
        "matériels": ["matériel", "outil", "machine"],
        "accessoires": ["accessoire", "sac", "ceinture", "montre", "bijoux", "lunettes"],
        "electronique": ["électronique", "smartphone", "ordinateur", "tablet", "tv", "caméra", "audio"],
        "livres": ["livre", "book", "roman", "manga", "bd", "bande dessinée", "éducation"],
        "sport": ["sport", "football", "basket", "tennis", "running", "fitness", "vélo", "musculation"]
      };
      for (const [category, keywords] of Object.entries(categoriesKeywords)) {
        for (const keyword of keywords) {
          if (name.includes(keyword) || description.includes(keyword) || imageUrl.includes(keyword)) {
            return category;
          }
        }
      }
      return "autres";
    }

    // Ajouter au panier
    function addToCart(name, price, description, imageUrl, sellerEmail, button) {
      button.textContent = "Ajouté!";
      button.disabled = true;
      button.style.backgroundColor = "#28a745";
      fetch('/api/add-to-cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, price, description, imageUrl, sellerEmail })
      })
      .then(response => response.ok ? response.json() : Promise.reject('Erreur API'))
      .then(data => {
        if (data.success) {
          cartCount++;
          updateCartCount();
        } else {
          throw new Error("Erreur lors de l'ajout au panier");
        }
      })
      .catch(err => {
        console.error("Échec lors de l'ajout au panier:", err);
        button.textContent = "Réessayer";
        button.disabled = false;
      });
      showNotification(`${name} ajouté au panier!`);
    }

    // Mise à jour du panier
    function updateCartCount() {
      document.getElementById("cartCount").textContent = cartCount;
    }

    // Notification
    function showNotification(message) {
      const notification = document.getElementById("notification");
      if (!notification) return;
      notification.textContent = message;
      notification.classList.add("show");
      setTimeout(() => notification.classList.remove("show"), 3000);
    }

    // Vue détail d'un produit
    function showProductDetailView(product) {
      currentProduct = product;
      const addToCartButton = document.getElementById("addToCartButton");
      if (addToCartButton) {
        addToCartButton.textContent = "Ajouter au panier";
        addToCartButton.disabled = false;
        addToCartButton.style.backgroundColor = "";
      }
      document.getElementById("productGrid").style.display = "none";
      document.getElementById("detailSection").style.display = "block";
      document.getElementById("detailImage").src = product.imageUrl || "";
      document.getElementById("detailImage").alt = product.productName || "Image du produit";
      document.getElementById("detailName").innerText = product.productName || "Nom inconnu";
      document.getElementById("detailDescription").innerText = product.description || "";
      document.getElementById("detailPrice").innerText = product.price ? `${product.price.toFixed(2)} FCFA` : "";
      document.getElementById("detailSeller").innerText = product.sellerEmail || "Inconnu";
      if (document.getElementById("detailDiscount"))
        document.getElementById("detailDiscount").innerText = product.discount ? product.discount + (product.discountType === "percentage" ? " %" : " FCFA") : "Aucune remise";
      if (document.getElementById("detailBrand"))
        document.getElementById("detailBrand").innerText = product.brand || "Non spécifiée";
      if (document.getElementById("detailSKU"))
        document.getElementById("detailSKU").innerText = product.sku || "N/A";
      if (document.getElementById("detailWeight"))
        document.getElementById("detailWeight").innerText = product.weight ? product.weight + " kg" : "Non spécifié";
      if (document.getElementById("detailDimensions") && product.dimensions) {
        const { length, width, height } = product.dimensions;
        document.getElementById("detailDimensions").innerText = `${length || 0} x ${width || 0} x ${height || 0} cm`;
      }
      if (document.getElementById("detailShippingCost"))
        document.getElementById("detailShippingCost").innerText = product.shippingCost ? product.shippingCost + " FCFA" : "Gratuit";
      if (document.getElementById("detailEstimatedDelivery"))
        document.getElementById("detailEstimatedDelivery").innerText = product.estimatedDelivery ? product.estimatedDelivery + " jours" : "Non précisé";
      if (document.getElementById("detailReturnPolicy"))
        document.getElementById("detailReturnPolicy").innerText = product.returnPolicy || "Non spécifiée";
      if (document.getElementById("detailWarranty"))
        document.getElementById("detailWarranty").innerText = product.warranty || "Aucune";
      if (document.getElementById("detailCreatedAt") && product.createdAt)
        document.getElementById("detailCreatedAt").innerText = new Date(product.createdAt).toLocaleDateString();
      if (document.getElementById("detailOrders") && product.orders !== undefined)
        document.getElementById("detailOrders").innerText = product.orders;
      if (document.getElementById("detailViews") && product.views !== undefined)
        document.getElementById("detailViews").innerText = product.views;
      if (document.getElementById("detailAddToCart") && product.addToCart !== undefined)
        document.getElementById("detailAddToCart").innerText = product.addToCart;
      if (product.videoUrl) {
        document.getElementById("detailVideo").src = product.videoUrl;
        document.getElementById("detailVideo").style.display = "block";
      } else {
        document.getElementById("detailVideo").style.display = "none";
      }
      const imageCarousel = document.getElementById("imageCarousel");
      if (imageCarousel) {
        imageCarousel.innerHTML = "";
        if (Array.isArray(product.images)) {
          product.images.forEach(imageUrl => {
            const img = document.createElement("img");
            img.src = imageUrl;
            img.alt = product.productName;
            img.addEventListener("click", () => {
              document.getElementById("detailImage").src = imageUrl;
            });
            imageCarousel.appendChild(img);
          });
        }
      }
      const similarProducts = allProducts.filter(p => {
        return (p._id !== product._id) && 
          (p.detectedCategory === product.detectedCategory || aiDetectCategory(p) === aiDetectCategory(product));
      });
      displaySimilarProducts(similarProducts);
      const reviewSection = document.getElementById("reviewSection");
      if (reviewSection) reviewSection.innerHTML = "";
      if (Array.isArray(product.reviews)) {
        product.reviews.forEach(review => {
          const div = document.createElement("div");
          div.className = "review-item";
          div.innerHTML = `<p>${review.comment}</p><p>${review.rating} ★</p>`;
          reviewSection.appendChild(div);
        });
      }
      const nextBtn = document.getElementById("nextProduct");
      if (nextBtn) {
        nextBtn.onclick = function() {
          const currentIndex = allProducts.findIndex(p => p._id === currentProduct._id);
          const nextProduct = allProducts[(currentIndex + 1) % allProducts.length];
          showProductDetailView(nextProduct);
        };
      }
      const prevBtn = document.getElementById("prevProduct");
      if (prevBtn) {
        prevBtn.onclick = function() {
          const currentIndex = allProducts.findIndex(p => p._id === currentProduct._id);
          const prevProduct = allProducts[(currentIndex - 1 + allProducts.length) % allProducts.length];
          showProductDetailView(prevProduct);
        };
      }
      document.getElementById("returnToProductsButton").addEventListener("click", hideDetailSection);
      const contactSellerButton = document.getElementById("contactSellerButton");
      if (contactSellerButton) contactSellerButton.style.display = "block";
      loadReviews(product._id);
    }

    // Affichage des produits similaires
    function displaySimilarProducts(products) {
      const similarGrid = document.getElementById("similarGrid");
      if (!similarGrid) return;
      similarGrid.innerHTML = "";
      if (products.length === 0) {
        similarGrid.innerHTML = "<p>Aucun produit similaire trouvé.</p>";
        return;
      }
      products.forEach(prod => {
        const div = document.createElement("div");
        div.className = "similar-item";
        div.innerHTML = `
          <img src="${prod.imageUrl}" alt="${prod.productName}">
          <div class="product-name">${prod.productName}</div>
          <div class="product-price">${prod.price} FCFA</div>
        `;
        div.addEventListener("click", function() {
          showProductDetailView(prod);
        });
        similarGrid.appendChild(div);
      });
    }

    window.showProductDetailView = showProductDetailView;
    window.hideDetailSection = hideDetailSection;
    window.orderProduct = orderProduct;
    window.contactSeller = function() {
      const messageInput = document.getElementById("contactSellerMessage");
      const message = messageInput ? messageInput.value : "";
      if (!message.trim()) {
        alert("Veuillez saisir votre message.");
        return;
      }
      alert("Message envoyé au vendeur : " + message);
      if (messageInput) messageInput.value = "";
    };
    window.filterProductsByKeyword = filterProductsByKeyword;
  </script>
</body>
</html>
